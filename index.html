<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admission Prediction Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/onnxruntime-web.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #f5f5f5;
    }
    h1 {
      color: #2b2b2b;
    }
    .container {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-width: 600px;
      margin: auto;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: bold;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      margin-top: 20px;
      padding: 12px 18px;
      background-color: #007bff;
      border: none;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .result {
      margin-top: 20px;
      font-size: 1.3em;
      color: #222;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Admission Chance Predictor</h1>
    <form id="predict-form">
      <div id="input-fields">
        <!-- Example numeric inputs (replace names with your real feature columns) -->
        <label>GRE Score</label>
        <input type="number" step="any" id="gre_score" required />

        <label>TOEFL Score</label>
        <input type="number" step="any" id="toefl_score" required />

        <label>University Rating</label>
        <input type="number" step="any" id="university_rating" required />

        <label>SOP</label>
        <input type="number" step="any" id="sop" required />

        <label>LOR</label>
        <input type="number" step="any" id="lor" required />

        <label>CGPA</label>
        <input type="number" step="any" id="cgpa" required />

        <label>Research (0 = No, 1 = Yes)</label>
        <input type="number" step="any" id="research" required />
      </div>

      <button type="submit">Predict</button>
    </form>

    <div id="result" class="result"></div>
  </div>

  <script>
    async function loadModel() {
      try {
        // Load ONNX model
        const session = await ort.InferenceSession.create('./model/best_model.onnx');
        console.log("Model loaded successfully!");
        return session;
      } catch (err) {
        console.error("Failed to load ONNX model:", err);
      }
    }

    // Example normalization (adjust if you used StandardScaler)
    function scaleInput(values) {
      // Replace these mean/std values with your preprocessor.joblib data
      const means = [320, 107, 3, 3, 3, 8.6, 0.5];
      const stds = [12, 6, 1, 1, 1, 0.6, 0.5];
      return values.map((v, i) => (v - means[i]) / stds[i]);
    }

    async function runPrediction(session, inputValues) {
      const inputTensor = new ort.Tensor('float32', Float32Array.from(inputValues), [1, inputValues.length]);
      const feeds = { input: inputTensor };
      const results = await session.run(feeds);
      const output = results.output.data[0];
      return output;
    }

    document.addEventListener("DOMContentLoaded", async () => {
      const session = await loadModel();
      const form = document.getElementById("predict-form");
      const resultDiv = document.getElementById("result");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const inputs = [
          parseFloat(document.getElementById("gre_score").value),
          parseFloat(document.getElementById("toefl_score").value),
          parseFloat(document.getElementById("university_rating").value),
          parseFloat(document.getElementById("sop").value),
          parseFloat(document.getElementById("lor").value),
          parseFloat(document.getElementById("cgpa").value),
          parseFloat(document.getElementById("research").value),
        ];

        const scaled = scaleInput(inputs);
        const pred = await runPrediction(session, scaled);
        resultDiv.innerHTML = `Predicted Chance of Admission: <span style="color:#007bff">${pred.toFixed(3)}</span>`;
      });
    });
  </script>
</body>
</html>
